machine:
    environment:
        DEBIAN_FRONTEND: noninteractive
    post:
    - sudo add-apt-repository -y ppa:masterminds/glide
    - sudo apt-get update
    - sudo apt-get install -y glide

dependencies:
    override:
    - mkdir -p ~/.go_workspace/src/github.com/signalfx
    - ln -s ~/neo-agent ~/.go_workspace/src/github.com/signalfx/neo-agent
    - glide install:
        pwd: ../.go_workspace/src/github.com/signalfx/neo-agent
    - make install:
        pwd: collectd-ext/stub

    cache_directories:
    - vendor

test:
    override:
    - go get github.com/tebeka/go2xunit
    - mkdir -p $CIRCLE_TEST_REPORTS/reports
    - make lint
    - go test -v `glide novendor` | go2xunit > $CIRCLE_TEST_REPORTS/reports/unit.xml:
        pwd: ../.go_workspace/src/github.com/signalfx/neo-agent
